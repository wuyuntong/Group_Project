---
title: "COVID19 contraction and deathes analysis"
format: html
editor: visual
author: Yuntong Wu & Jiaxin Shen
---

## Description of the data sources

The data we selected comes from the following three websites: The file analytic_data2021 comes from the County Health Rankings & Roadmaps (CHR&R) County Health Rankings & Roadmaps (CHR&R) is a program of the University of Wisconsin Population Health Institute. The CHR&R program provides data, evidence, guidance, and examples to build awareness of the multiple factors that influence health and support leaders in growing community power to improve health equity. The Rankings measure the health of nearly every county in all 50 states.

This file provides various health-related data indicators for U.S. counties in 2021, including health behaviors, clinical care, as well as social and economic factors. We plan to select 8 of the variables (Adult smoking, Adult obesity, Food environment index, Physical inactivity, Excessive, drinking, Uninsured, Primary care physicians and Violent crime}as measures of residents' health levels and study whether there is a correlation between these variables and the covid numbers.

The files covid_confirmed_usafacts and covid_deaths_usafacts come from USAFacts, which dedicated to providing comprehensive, real-time pandemic data from all 50 states especially the data on hotspots and infection rates.

These two files provide respectively the daily data on confirmed cases and deaths from the epidemic by county in the United States from January 2020 to July 2023. We will combine daily data into monthly data to to make the data more intuitive and representative. The covid confirmed number is the main target variable of our analysis.

These four files Education, PopulationEstimates, PovertyEstimates and Unemployment come from USDA'sÂ Economic Research Service, which anticipate trends and emerging issues in agriculture, food, the environment, and rural America and to conduct high-quality, objective economic research to inform and enhance public and private decision making.

The file Education provides the basic information on the educational attainment of counties in the United States from 2017 to 2021. We mainly select the variable "Percent of adults with age bachelor's degree or higher" to analyze whether there is a correlation between the educational attainment of counties in the United States and the number of confirmed cases.

PopulationEstimates provides the estimated number of population by county in the United States from 2020 to 2022. We choose the two variables of birth rate and death rate in 2021 as analysis indicators.

The data form PovertyEstimates are model-based estimates from the U.S. Census Bureau's Small Area Income and Poverty Estimate (SAIPE) program. This file includes the estimated poverty data of counties in the United States in 2021, and we select the Estimated percent of people of all ages in poverty 2021 as the research variable.

Unemployment includes overall employment status by county in the United States from 2000 to 2022. We mainly choose the unemployment rate and median household income to measure the employment level of each county, and use these two variables to study whether there is a correlation between the poverty level and the number of confirmed cases.

```{r}
#| message: false
here::i_am("Group_Project.Rproj")
library(here)
library(vroom)
library(dplyr)
library(tidyr)
library(ggplot2)
theme_set(theme_bw())
```

Github link:<https://github.com/wuyuntong/Group_Project>

Sources links: Health data: <https://www.countyhealthrankings.org/explore-health-rankings/rankings-data-documentation>

Covid data: <https://usafacts.org/visualizations/coronavirus-covid-19-spread-map/>

Social-economic data: <https://www.ers.usda.gov/data-products/county-level-data-sets/county-level-data-sets-download-data/>

## Data Loading

```{r}
health <- vroom(here("data", "analytic_data2021.csv"))
cases <- vroom(here("data", "covid_confirmed_usafacts.csv"))
deaths <- vroom(here("data", "covid_deaths_usafacts.csv"))
edu <- vroom(here("data", "Education.csv"))
pop <- vroom(here("data", "PopulationEstimates.csv"))
pov <- vroom(here("data", "PovertyEstimates.csv"))
ump <- vroom(here("data", "Unemployment.csv"))
```

## Data cleaning

```{r}
cov_clean <- function(df) {
  df <- df |>
    select(
      countyFIPS, `County Name`, State, StateFIPS,
      `2020-07-31`, `2020-08-31`, `2020-09-30`, `2020-10-31`,
      `2020-11-30`, `2020-12-31`, `2021-01-31`, `2021-02-28`,
      `2021-03-31`, `2021-04-30`, `2021-05-31`, `2021-06-30`
    ) |>
    rename(
      `2020-07` = `2020-07-31`,
      `2020-08` = `2020-08-31`,
      `2020-09` = `2020-09-30`,
      `2020-10` = `2020-10-31`,
      `2020-11` = `2020-11-30`,
      `2020-12` = `2020-12-31`,
      `2021-01` = `2021-01-31`,
      `2021-02` = `2021-02-28`,
      `2021-03` = `2021-03-31`,
      `2021-04` = `2021-04-30`,
      `2021-05` = `2021-05-31`,
      `2021-06` = `2021-06-30`
    )
}
```

```{r}
cases_mon <- cov_clean(cases)
deaths_mon <- cov_clean(deaths)
```

## Graphic representation of target variables

```{r}
cases_mon |>
  group_by(State) |>
  summarise(across(starts_with("2020"), sum), across(starts_with("2021"), sum)) |>
  pivot_longer(cols = starts_with("202"), names_to = "month", values_to = "count") |>
  ggplot(aes(x = month, y = count, group = State, color = State)) + geom_line() +
  labs(title = "Total cases reported across all 50 states from July 2020 to June 2021") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1),
        plot.title = element_text(margin = margin(b = 40)))
```

```{r}
deaths_mon |>
  group_by(State) |>
  summarise(across(starts_with("2020"), sum), across(starts_with("2021"), sum)) |>
  pivot_longer(cols = starts_with("202"), names_to = "month", values_to = "count") |>
  ggplot(aes(x = month, y = count, group = State, color = State)) + geom_line() +
  labs(title = "Total deaths reported across all 50 states from July 2020 to June 2021") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1),
        plot.title = element_text(margin = margin(b = 40)))
```

```{r}
cases_mon |>
  group_by(State) |>
  summarise(across(starts_with("2020"), sum), across(starts_with("2021"), sum)) |>
  pivot_longer(cols = starts_with("202"), names_to = "month", values_to = "count") |>
  group_by(State) |>
  mutate_at(vars(count), list(~ .x - lag(.x)))  |>
  na.omit() |>
  ggplot(aes(x = month, y = count, group = State, color = State)) + geom_line() +
  labs(title = "New reported cases across all 50 states from August 2020 to June 2021") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1),
        plot.title = element_text(margin = margin(b = 40)))
```
```{r}
deaths_mon |>
  group_by(State) |>
  summarise(across(starts_with("2020"), sum), across(starts_with("2021"), sum)) |>
  pivot_longer(cols = starts_with("202"), names_to = "month", values_to = "count") |>
  group_by(State) |>
  mutate_at(vars(count), list(~ .x - lag(.x)))  |>
  na.omit() |>
  ggplot(aes(x = month, y = count, group = State, color = State)) + geom_line() +
  labs(title = "New reported deaths across all 50 states from August 2020 to June 2021") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1),
        plot.title = element_text(margin = margin(b = 40)))
```

```{r}
cases_mon |>
  summarise(across(starts_with("202"), sum)) |>
  pivot_longer(cols = starts_with("202"), names_to = "month", values_to = "count") |>
  ggplot(aes(x = month, y = count, group = 1)) + 
  geom_line() +
  labs(title = "Nationwide total cases reported from July 2020 to June 2021")
```

```{r}
deaths_mon |>
  summarise(across(starts_with("202"), sum)) |>
  pivot_longer(cols = starts_with("202"), names_to = "month", values_to = "count") |>
  ggplot(aes(x = month, y = count, group = 1)) + 
  geom_line() +
  labs(title = "Nationwide total deaths reported from July 2020 to June 2021")
```



```{r}
cases_mon |>
  summarise(across(starts_with("202"), sum)) |>
  pivot_longer(cols = starts_with("202"), names_to = "month", values_to = "count") |>
  mutate_at(vars(count), list(~ .x - lag(.x))) |>
  na.omit() |>
  ggplot(aes(x = month, y = count, group = 1)) + 
  geom_line() +
  labs(title = "Nationwide new cases reported from August 2020 to June 2021")
```

```{r}
deaths_mon |>
  summarise(across(starts_with("202"), sum)) |>
  pivot_longer(cols = starts_with("202"), names_to = "month", values_to = "count") |>
  mutate_at(vars(count), list(~ .x - lag(.x))) |>
  na.omit() |>
  ggplot(aes(x = month, y = count, group = 1)) + 
  geom_line() +
  labs(title = "Nationwide new deaths reported from August 2020 to June 2021")
```


